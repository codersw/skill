<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skill.server.mapper.CourseMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.skill.server.entity.pojo.Course">
        <id column="courseid" property="courseid" />
        <result column="coursetitle" property="coursetitle" />
        <result column="subjectid" property="subjectid" />
        <result column="gradeid" property="gradeid" />
        <result column="coursetype" property="coursetype" />
        <result column="content" property="content" />
        <result column="cover" property="cover" />
        <result column="ctime" property="ctime" />
        <result column="utime" property="utime" />
        <result column="istop" property="istop" />
        <result column="isdel" property="isdel" />
        <result column="coursedate" property="coursedate" />
        <result column="count" property="count" />
    </resultMap>

    <!--学生查询结果-->
    <resultMap id="StudentCourseListVo" type="com.skill.server.entity.vo.StudentCourseListVo" extends="BaseResultMap">
        <result column="common" property="common" />
        <result column="heighten" property="heighten" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        courseid, coursetitle, subjectid, gradeid, coursetype, content, cover, ctime, utime, istop, isdel, coursedate, `count`
    </sql>

    <!--获取学生课程列表-->
    <select id="studentCourselist" resultMap="StudentCourseListVo">
        SELECT
            cc.courseid,
            cc.cover,
            cc.coursetitle,
            cc.`count`
        FROM
        ck_course cc
            INNER JOIN ck_course_school ccs ON cc.courseid = ccs.courseid
        <where>
            cc.isdel='0'
            and cc.istop='1'
            <if test="courseListCo.coursetitle != null and courseListCo.coursetitle !=''">
               and cc.coursetitle LIKE CONCAT('%',#{courseListCo.coursetitle},'%')
            </if>
            <if test="courseListCo.schoolid != null and courseListCo.schoolid !=''">
               and ccs.schoolid = #{courseListCo.schoolid}
            </if>
            <if test="courseListCo.gradeid != null and courseListCo.gradeid !=''">
               and cc.gradeid = #{courseListCo.gradeid}
            </if>
            <if test="courseListCo.subjectid != null and courseListCo.subjectid !=''">
                and cc.subjectid = #{courseListCo.subjectid}
            </if>
            ORDER BY  cc.coursedate ASC,cc.ctime ASC
        </where>
    </select>

    <!--获取学生课程列表分页-->
    <select id="studentCoursePagelist" resultMap="StudentCourseListVo">
        SELECT
        cc.courseid,
        cc.cover,
        cc.coursetitle,
        cc.`count`
        FROM
        ck_course cc
        INNER JOIN ck_course_school ccs ON cc.courseid = ccs.courseid
        <where>
            cc.isdel='0'
            and cc.istop='1'
            <if test="courseListCo.coursetitle != null and courseListCo.coursetitle !=''">
                and cc.coursetitle LIKE CONCAT('%',#{courseListCo.coursetitle},'%')
            </if>
            <if test="courseListCo.schoolid != null and courseListCo.schoolid !=''">
                and ccs.schoolid = #{courseListCo.schoolid}
            </if>
            <if test="courseListCo.gradeid != null and courseListCo.gradeid !=''">
                and cc.gradeid = #{courseListCo.gradeid}
            </if>
            <if test="courseListCo.subjectid != null and courseListCo.subjectid !=''">
                and cc.subjectid = #{courseListCo.subjectid}
            </if>
            GROUP BY cc.courseid
            ORDER BY cc.coursedate ASC,cc.ctime ASC
        </where>
    </select>

    <select id="selectLevelcount" resultMap="StudentCourseListVo">
        SELECT
            IFNULL(sum(case cct.`level` when '1' then 1 else 0 end),'0') common,
            IFNULL(sum(case cct.`level` when '2' then 1 else 0 end),'0') heighten
        FROM
            ck_course_item_testpaper ccit
        INNER JOIN ck_course_testpaper cct ON ccit.paperid=cct.paperid
            AND ccit.courseid=#{courseid}
    </select>

    <!--查询科目年级下的课程数-->
    <select id="selectCourseCountBySubjectIdAndGradeId" resultType="int">
        SELECT
          count(1)
        FROM
          ck_course
        WHERE subjectid = #{subjectid} AND gradeid = #{gradeid} AND isdel = '0'
    </select>


</mapper>
