<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skill.server.mapper.CourseSubjectMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.skill.server.entity.pojo.CourseSubject">
        <id column="subjectid" property="subjectid" />
        <result column="subjectname" property="subjectname" />
        <result column="status" property="status" />
        <result column="content" property="content" />
        <result column="ctime" property="ctime" />
        <result column="utime" property="utime" />
        <result column="istop" property="istop" />
        <result column="num" property="num" />
    </resultMap>

    <!--科目查询结果-->
    <resultMap id="CourseSubjectVo" type="com.skill.server.entity.vo.CourseSubjectVo" extends="BaseResultMap">
        <result column="count" property="count" />
    </resultMap>

    <resultMap id="HomePageCourseSubJectVo" type="com.skill.server.entity.vo.HomePageCourseSubJectVo" extends="BaseResultMap">
        <result column="subcount" property="subcount" />
        <result column="stusubcount" property="stusubcount" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        subjectid, subjectname, status, content, ctime, utime, istop, num
    </sql>
    <select id="selectSubjectList" resultMap="CourseSubjectVo">
        SELECT
            ccs.subjectid,
            ccs.subjectname
        FROM
            ck_course_subject ccs
        INNER JOIN ck_course_subject_grade ccsg ON ccsg.subjectid=ccs.subjectid
        and ccsg.status='1'
        and ccs.status='1'
        AND ccsg.gradeid = #{gradeid}
        order by ccs.num + 0 asc
    </select>
    <select id="selectSubjectListAll" resultMap="CourseSubjectVo">
        SELECT
            cs.subjectid,
            cs.subjectname
        FROM
            ck_course_subject cs
        INNER JOIN ck_course_subject_grade csg ON cs.subjectid=csg.subjectid
        WHERE
            cs.`status` = '1'
        GROUP BY
            cs.subjectid
        ORDER BY
            cs.num + 0 ASC
    </select>

    <select id="selectHomeSubjectList" resultMap="HomePageCourseSubJectVo">
        SELECT
            ccs.subjectid,
            ccs.subjectname
        FROM
            ck_course_subject ccs
        INNER JOIN ck_course_subject_grade ccsg ON ccsg.subjectid=ccs.subjectid
        and ccsg.status='1'
        and ccs.status='1'
        AND ccsg.gradeid=#{gradeid}
        order by ccs.num + 0 asc
    </select>
    <select id="courseSubjectAll" resultMap="BaseResultMap">
        select
            subjectid,
            subjectname
        FROM
            ck_course_subject
            <where>
                `status`='1'
            </where>
            order by num + 0 asc
    </select>

    <select id="courseSubjectList" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from ck_course_subject where `status`='1'
        <if test="teacherid != null and teacherid !=''">
            and subjectid in (select subjectid from ck_teacher_subject where teacherid = #{teacherid})
        </if>
        <if test="schoolid != null and schoolid != ''">
            and subjectid in (SELECT
            subjectid
            FROM
            ck_course_subject_grade sg
            inner join ck_school_class sc on sg.gradeid = sc.gradeid and sc.schoolid = #{schoolid}
            GROUP BY sg.subjectid)
        </if>
        order by num + 0 asc
    </select>


</mapper>
