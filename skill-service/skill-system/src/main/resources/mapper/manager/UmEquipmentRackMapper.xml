<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skill.manager.mapper.UmEquipmentRackMapper">

    <resultMap type="UmEquipmentRack" id="UmEquipmentRackResult">
        <result property="rackId"    column="rack_id"    />
        <result property="rackAisleId"    column="rack_aisle_id"    />
        <result property="dcRoomId"    column="dc_room_id"    />
        <result property="datacenterId"    column="datacenter_id"    />
        <result property="factoryId"    column="factory_id"    />
        <result property="rackType"    column="rack_type"    />
        <result property="rackName"    column="rack_name"    />
        <result property="serialNo"    column="serial_no"    />
        <result property="manuFacturer"    column="manu_facturer"    />
        <result property="modelName"    column="model_name"    />
        <result property="partsNo"    column="parts_no"    />
        <result property="pduId"    column="pdu_id"    />
        <result property="rduId"    column="rdu_id"    />
        <result property="installationDate"    column="installation_date"    />
        <result property="description"    column="description"    />
        <result property="width"    column="width"    />
        <result property="height"    column="height"    />
        <result property="depth"    column="depth"    />
        <result property="limitskill"    column="limit_skill"    />
        <result property="actualskill"    column="actual_skill"    />
        <result property="startskill"    column="start_skill"    />
        <result property="endskill"    column="end_skill"    />
        <result property="slotskill"    column="slot_skill"    />
        <result property="limitServer"    column="limit_server"    />
        <result property="actualServer"    column="actual_server"    />
        <result property="limitWeight"    column="limit_weight"    />
        <result property="maxWeight"    column="max_weight"    />
        <result property="actualWeight"    column="actual_weight"    />
        <result property="limitPower"    column="limit_power"    />
        <result property="relativeX"    column="relative_x"    />
        <result property="relativeY"    column="relative_y"    />
        <result property="relativeZ"    column="relative_z"    />
        <result property="absoluteX"    column="absolute_x"    />
        <result property="absoluteY"    column="absolute_y"    />
        <result property="absoluteZ"    column="absolute_z"    />
        <result property="relativerotX"    column="relativerot_x"    />
        <result property="relativerotY"    column="relativerot_y"    />
        <result property="relativerotZ"    column="relativerot_z"    />
        <result property="absoluterotX"    column="absoluterot_x"    />
        <result property="absoluterotY"    column="absoluterot_y"    />
        <result property="absoluterotZ"    column="absoluterot_z"    />
        <result property="status"    column="status"    />
        <result property="createBy"    column="create_by"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateBy"    column="update_by"    />
        <result property="updateTime"    column="update_time"    />
        <result property="tdModelId"    column="td_model_id"    />
        <result property="states"    column="states"    />

    </resultMap>

    <sql id="selectUmEquipmentRackVo">
        select
        f.factory_name as factoryName,dc.datacenter_name as datacenterName,dcr.dc_room_name as dcRoomName,
        era.rack_aisle_name as rackAisleName,ucrt.rack_type_name as rackTypeName,
        uer.rack_id, uer.rack_aisle_id, uer.dc_room_id, uer.datacenter_id, uer.factory_id,
         uer.rack_type, uer.rack_name, uer.serial_no,uer. manu_facturer,uer. model_name, uer.parts_no,
          uer.pdu_id, uer.rdu_id, uer.installation_date,uer.description, uer.width, uer.height, uer.depth,
           uer.limit_skill, uer.actual_skill, uer.start_skill, uer.end_skill, uer.slot_skill, uer.limit_server,
            uer.actual_server, uer.limit_weight, uer.max_weight, uer.actual_weight, uer.limit_power,
             uer.relative_x, uer.relative_y, uer.relative_z, uer.absolute_x, uer.absolute_y, uer.absolute_z,
              uer.relativerot_x, uer.relativerot_y, uer.relativerot_z, uer.absoluterot_x, uer.absoluterot_y,
               uer.absoluterot_z,uer.status, uer.create_by, uer.create_time, uer.update_by, uer.update_time,
               uer.td_model_id, uer.states,manu_facturer.dict_label manuFacturerName
          from um_equipment_rack uer
          left join um_scene_datacenter dc on uer.datacenter_id = dc.datacenter_id
          left join um_scene_factory f on uer.factory_id = f.factory_id
          left join um_scene_datacenter_room  dcr on uer.dc_room_id = dcr.dc_room_id
          left join um_equipment_rack_aisle era on uer.rack_aisle_id = era.rack_aisle_id
          left join um_codelist_rack_type ucrt on uer.rack_type = ucrt.rack_type_id
          left join (select * from sys_dict_data where dict_type = 'manu_facturer') manu_facturer
                                                     on uer.manu_facturer = manu_facturer.dict_value
    </sql>

    <select id="selectUmEquipmentRackList" parameterType="UmEquipmentRack" resultMap="UmEquipmentRackResult">
        <include refid="selectUmEquipmentRackVo"/>
        <where>
            and uer.status = '0'
            <if test="states != null  and states != ''"> and uer.states = #{states}</if>
            <if test="rackAisleId != null  and rackAisleId != ''"> and uer.rack_aisle_id = #{rackAisleId}</if>
            <if test="dcRoomId != null  and dcRoomId != ''"> and uer.dc_room_id = #{dcRoomId}</if>
            <if test="datacenterId != null  and datacenterId != ''"> and uer.datacenter_id = #{datacenterId}</if>
            <if test="factoryId != null  and factoryId != ''"> and uer.factory_id = #{factoryId}</if>
            <if test="rackType != null  and rackType != ''"> and uer.rack_type = #{rackType}</if>
            <if test="rackName != null  and rackName != ''"> and uer.rack_name like concat('%', #{rackName}, '%')</if>
            <if test="serialNo != null  and serialNo != ''"> and uer.serial_no = #{serialNo}</if>
            <if test="manuFacturer != null  and manuFacturer != ''"> and uer.manu_facturer like concat('%', #{manuFacturer}, '%')</if>
            <if test="partsNo != null  and partsNo != ''"> and uer.parts_no = #{partsNo}</if>
            <if test="beginTime != null and beginTime != '' and endTime != null and endTime != ''"> and uer.installation_date between #{beginTime} and #{endTime}</if>
        </where>
        order by uer.create_time  desc
    </select>

    <select id="selectUmEquipmentRackById" parameterType="String" resultMap="UmEquipmentRackResult">
        <include refid="selectUmEquipmentRackVo"/>
        where uer.rack_id = #{rackId}
    </select>

    <select id="selectumequipmentracklist" parameterType="UmEquipmentRack" resultMap="UmEquipmentRackResult">
        SELECT rack_aisle_id AS 'pId',rack_id AS 'key',rack_name AS 'title' FROM um_equipment_rack
        <where>
            status='0' and  rack_aisle_id !='' and  rack_aisle_id is not null
        </where>
    </select>
    <!--查询房间下的机柜-->
    <select id="selectEquipmentRackListOfRoom" parameterType="UmEquipmentRack" resultMap="UmEquipmentRackResult">
        SELECT dc_room_id AS 'pId',rack_id AS 'key',rack_name AS 'title' FROM um_equipment_rack
        <where>
            status='0' and ( rack_aisle_id =''  or rack_aisle_id is null )
        </where>
    </select>

    <!--获取项目关联的机柜-->
    <select id="selectProjectEquipmentRackList" resultMap="UmEquipmentRackResult">
        SELECT distinct uer.*, f.factory_name as factoryName,
        dc.datacenter_name as datacenterName,dcr.dc_room_name as dcRoomName,
        era.rack_aisle_name as rackAisleName,ucrt.rack_type_name as rackTypeName
        FROM  um_project_rack upr
        left join  um_equipment_rack uer on upr.rack_id = uer.rack_id
        left join um_scene_datacenter dc on uer.datacenter_id = dc.datacenter_id
        left join um_scene_factory f on uer.factory_id = f.factory_id
        left join um_scene_datacenter_room  dcr on uer.dc_room_id = dcr.dc_room_id
        left join um_equipment_rack_aisle era on uer.rack_aisle_id = era.rack_aisle_id
        left join um_codelist_rack_type ucrt on uer.rack_type = ucrt.rack_type_id
        <where>
            uer.status='0'
            and
            upr.project_id in
            <foreach item="item" index="index" collection="projectIds" open="(" separator="," close=")">
                #{item}
            </foreach>
        </where>
    </select>

    <insert id="insertUmEquipmentRack" parameterType="UmEquipmentRack">
        insert into um_equipment_rack
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="rackId != null  and rackId != ''">rack_id,</if>
            <if test="rackAisleId != null  and rackAisleId != ''">rack_aisle_id,</if>
            <if test="dcRoomId != null  and dcRoomId != ''">dc_room_id,</if>
            <if test="datacenterId != null  and datacenterId != ''">datacenter_id,</if>
            <if test="factoryId != null  and factoryId != ''">factory_id,</if>
            <if test="rackType != null  and rackType != ''">rack_type,</if>
            <if test="rackName != null  and rackName != ''">rack_name,</if>
            <if test="serialNo != null  and serialNo != ''">serial_no,</if>
            <if test="manuFacturer != null  and manuFacturer != ''">manu_facturer,</if>
            <if test="modelName != null  and modelName != ''">model_name,</if>
            <if test="partsNo != null  and partsNo != ''">parts_no,</if>
            <if test="pduId != null  and pduId != ''">pdu_id,</if>
            <if test="rduId != null  and rduId != ''">rdu_id,</if>
            <if test="installationDate != null ">installation_date,</if>
            <if test="description != null  and description != ''">description,</if>
            <if test="width != null ">width,</if>
            <if test="height != null ">height,</if>
            <if test="depth != null ">depth,</if>
            <if test="limitskill != null ">limit_skill,</if>
            <if test="actualskill != null ">actual_skill,</if>
            <if test="startskill != null ">start_skill,</if>
            <if test="endskill != null ">end_skill,</if>
            <if test="slotskill != null ">slot_skill,</if>
            <if test="limitServer != null ">limit_server,</if>
            <if test="actualServer != null ">actual_server,</if>
            <if test="limitWeight != null ">limit_weight,</if>
            <if test="maxWeight != null ">max_weight,</if>
            <if test="actualWeight != null ">actual_weight,</if>
            <if test="limitPower != null ">limit_power,</if>
            <if test="relativeX != null ">relative_x,</if>
            <if test="relativeY != null ">relative_y,</if>
            <if test="relativeZ != null ">relative_z,</if>
            <if test="absoluteX != null ">absolute_x,</if>
            <if test="absoluteY != null ">absolute_y,</if>
            <if test="absoluteZ != null ">absolute_z,</if>
            <if test="relativerotX != null ">relativerot_x,</if>
            <if test="relativerotY != null ">relativerot_y,</if>
            <if test="relativerotZ != null ">relativerot_z,</if>
            <if test="absoluterotX != null ">absoluterot_x,</if>
            <if test="absoluterotY != null ">absoluterot_y,</if>
            <if test="absoluterotZ != null ">absoluterot_z,</if>
            <if test="status != null  and status != ''">status,</if>
            <if test="createBy != null  and createBy != ''">create_by,</if>
            <if test="createTime != null ">create_time,</if>
            <if test="updateBy != null  and updateBy != ''">update_by,</if>
            <if test="updateTime != null ">update_time,</if>
            <if test="states != null  and states != ''">states,</if>
            <if test="tdModelId != null  and tdModelId != ''">td_model_id,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="rackId != null  and rackId != ''">#{rackId},</if>
            <if test="rackAisleId != null  and rackAisleId != ''">#{rackAisleId},</if>
            <if test="dcRoomId != null  and dcRoomId != ''">#{dcRoomId},</if>
            <if test="datacenterId != null  and datacenterId != ''">#{datacenterId},</if>
            <if test="factoryId != null  and factoryId != ''">#{factoryId},</if>
            <if test="rackType != null  and rackType != ''">#{rackType},</if>
            <if test="rackName != null  and rackName != ''">#{rackName},</if>
            <if test="serialNo != null  and serialNo != ''">#{serialNo},</if>
            <if test="manuFacturer != null  and manuFacturer != ''">#{manuFacturer},</if>
            <if test="modelName != null  and modelName != ''">#{modelName},</if>
            <if test="partsNo != null  and partsNo != ''">#{partsNo},</if>
            <if test="pduId != null  and pduId != ''">#{pduId},</if>
            <if test="rduId != null  and rduId != ''">#{rduId},</if>
            <if test="installationDate != null ">#{installationDate},</if>
            <if test="description != null  and description != ''">#{description},</if>
            <if test="width != null ">#{width},</if>
            <if test="height != null ">#{height},</if>
            <if test="depth != null ">#{depth},</if>
            <if test="limitskill != null ">#{limitskill},</if>
            <if test="actualskill != null ">#{actualskill},</if>
            <if test="startskill != null ">#{startskill},</if>
            <if test="endskill != null ">#{endskill},</if>
            <if test="slotskill != null ">#{slotskill},</if>
            <if test="limitServer != null ">#{limitServer},</if>
            <if test="actualServer != null ">#{actualServer},</if>
            <if test="limitWeight != null ">#{limitWeight},</if>
            <if test="maxWeight != null ">#{maxWeight},</if>
            <if test="actualWeight != null ">#{actualWeight},</if>
            <if test="limitPower != null ">#{limitPower},</if>
            <if test="relativeX != null ">#{relativeX},</if>
            <if test="relativeY != null ">#{relativeY},</if>
            <if test="relativeZ != null ">#{relativeZ},</if>
            <if test="absoluteX != null ">#{absoluteX},</if>
            <if test="absoluteY != null ">#{absoluteY},</if>
            <if test="absoluteZ != null ">#{absoluteZ},</if>
            <if test="relativerotX != null ">#{relativerotX},</if>
            <if test="relativerotY != null ">#{relativerotY},</if>
            <if test="relativerotZ != null ">#{relativerotZ},</if>
            <if test="absoluterotX != null ">#{absoluterotX},</if>
            <if test="absoluterotY != null ">#{absoluterotY},</if>
            <if test="absoluterotZ != null ">#{absoluterotZ},</if>
            <if test="status != null  and status != ''">#{status},</if>
            <if test="createBy != null  and createBy != ''">#{createBy},</if>
            <if test="createTime != null ">#{createTime},</if>
            <if test="updateBy != null  and updateBy != ''">#{updateBy},</if>
            <if test="updateTime != null ">#{updateTime},</if>
            <if test="states != null  and states != ''">#{states},</if>
            <if test="tdModelId != null  and tdModelId != ''">#{tdModelId},</if>
         </trim>
    </insert>

    <update id="updateUmEquipmentRack" parameterType="UmEquipmentRack">
        update um_equipment_rack
        <trim prefix="SET" suffixOverrides=",">
            <if test="rackAisleId != null ">rack_aisle_id = #{rackAisleId},</if>
            <if test="dcRoomId != null  ">dc_room_id = #{dcRoomId},</if>
            <if test="datacenterId != null  ">datacenter_id = #{datacenterId},</if>
            <if test="factoryId != null  ">factory_id = #{factoryId},</if>
            <if test="rackType != null  ">rack_type = #{rackType},</if>
            <if test="rackName != null  ">rack_name = #{rackName},</if>
            <if test="serialNo != null  ">serial_no = #{serialNo},</if>
            <if test="manuFacturer != null ">manu_facturer = #{manuFacturer},</if>
            <if test="modelName != null  ">model_name = #{modelName},</if>
            <if test="partsNo != null ">parts_no = #{partsNo},</if>
            <if test="pduId != null ">pdu_id = #{pduId},</if>
            <if test="rduId != null  ">rdu_id = #{rduId},</if>
            <if test="installationDate != null ">installation_date = #{installationDate},</if>
            <if test="description != null ">description = #{description},</if>
            <if test="width != null ">width = #{width},</if>
            <if test="height != null ">height = #{height},</if>
            <if test="depth != null ">depth = #{depth},</if>
            <if test="limitskill != null ">limit_skill = #{limitskill},</if>
            <if test="actualskill != null ">actual_skill = #{actualskill},</if>
            <if test="startskill != null ">start_skill = #{startskill},</if>
            <if test="endskill != null ">end_skill = #{endskill},</if>
            <if test="slotskill != null ">slot_skill = #{slotskill},</if>
            <if test="limitServer != null ">limit_server = #{limitServer},</if>
            <if test="actualServer != null ">actual_server = #{actualServer},</if>
            <if test="limitWeight != null ">limit_weight = #{limitWeight},</if>
            <if test="maxWeight != null ">max_weight = #{maxWeight},</if>
            <if test="actualWeight != null ">actual_weight = #{actualWeight},</if>
            <if test="limitPower != null ">limit_power = #{limitPower},</if>
            <if test="relativeX != null ">relative_x = #{relativeX},</if>
            <if test="relativeY != null ">relative_y = #{relativeY},</if>
            <if test="relativeZ != null ">relative_z = #{relativeZ},</if>
            <if test="absoluteX != null ">absolute_x = #{absoluteX},</if>
            <if test="absoluteY != null ">absolute_y = #{absoluteY},</if>
            <if test="absoluteZ != null ">absolute_z = #{absoluteZ},</if>
            <if test="relativerotX != null ">relativerot_x = #{relativerotX},</if>
            <if test="relativerotY != null ">relativerot_y = #{relativerotY},</if>
            <if test="relativerotZ != null ">relativerot_z = #{relativerotZ},</if>
            <if test="absoluterotX != null ">absoluterot_x = #{absoluterotX},</if>
            <if test="absoluterotY != null ">absoluterot_y = #{absoluterotY},</if>
            <if test="absoluterotZ != null ">absoluterot_z = #{absoluterotZ},</if>
            <if test="status != null  and status != ''">status = #{status},</if>
            <if test="createBy != null  and createBy != ''">create_by = #{createBy},</if>
            <if test="createTime != null ">create_time = #{createTime},</if>
            <if test="updateBy != null  and updateBy != ''">update_by = #{updateBy},</if>
            <if test="updateTime != null ">update_time = #{updateTime},</if>
            <if test="states != null  and states != ''">states = #{states},</if>
            <if test="tdModelId != null ">td_model_id = #{tdModelId},</if>
        </trim>
        where rack_id = #{rackId}
    </update>

    <!--逻辑删除时使用该语句-->
    <update id="deleteUmEquipmentRackByIds" parameterType="String">
        update um_equipment_rack
        <trim prefix="SET" suffixOverrides=",">
            status = '1'
        </trim>
        where  rack_id in
        <foreach item="rackId" collection="array" open="(" separator="," close=")">
            #{rackId}
        </foreach>
    </update>

    <delete id="deleteUmEquipmentRackById" parameterType="String">
        delete from um_equipment_rack where rack_id = #{rackId}
    </delete>

<!--    <delete id="deleteUmEquipmentRackByIds" parameterType="String">-->
<!--        delete from um_equipment_rack where rack_id in -->
<!--        <foreach item="rackId" collection="array" open="(" separator="," close=")">-->
<!--            #{rackId}-->
<!--        </foreach>-->
<!--    </delete>-->

</mapper>