<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skill.manager.mapper.UmEquipmentMapper">

    <resultMap type="UmEquipment" id="UmEquipmentResult">
        <result property="equipmentId"    column="equipment_id"    />
        <result property="rackId"    column="rack_id"    />
        <result property="rackAisleId"    column="rack_aisle_id"    />
        <result property="dcRoomId"    column="dc_room_id"    />
        <result property="datacenterId"    column="datacenter_id"    />
        <result property="factoryId"    column="factory_id"    />
        <result property="equipmentType"    column="equipment_type"    />
        <result property="isRackEquipment"    column="is_rack_equipment"    />
        <result property="equipmentName" column="equipment_name"/>
        <result property="serialNo"    column="serial_no"    />
        <result property="manuFacturer"    column="manu_facturer"    />
        <result property="modelName"    column="model_name"    />
        <result property="partsNo"    column="parts_no"    />
        <result property="installationDate"    column="installation_date"    />
        <result property="description"    column="description"    />
        <result property="width"    column="width"    />
        <result property="height"    column="height"    />
        <result property="depth"    column="depth"    />
        <result property="skill"    column="skill"    />
        <result property="startskill"    column="start_skill"    />
        <result property="weight"    column="weight"    />
        <result property="limitPower"    column="limit_power"    />
        <result property="relativeX"    column="relative_x"    />
        <result property="relativeY"    column="relative_y"    />
        <result property="relativeZ"    column="relative_z"    />
        <result property="absoluteX"    column="absolute_x"    />
        <result property="absoluteY"    column="absolute_y"    />
        <result property="absoluteZ"    column="absolute_z"    />
        <result property="relativerotX"    column="relativerot_x"    />
        <result property="relativerotY"    column="relativerot_y"    />
        <result property="relativerotZ"    column="relativerot_z"    />
        <result property="absoluterotX"    column="absoluterot_x"    />
        <result property="absoluterotY"    column="absoluterot_y"    />
        <result property="absoluterotZ"    column="absoluterot_z"    />
        <result property="status"    column="status"    />
        <result property="createBy"    column="create_by"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateBy"    column="update_by"    />
        <result property="updateTime"    column="update_time"    />
        <result property="rackName"    column="rack_name"    />
        <result property="rackAisleName"    column="rack_aisle_name"    />
        <result property="manuFacturerName" column="manu_facturer_name"/>
        <result property="equipmentTypeName" column="equipment_type_name" />
        <result property="isRackEquipmentName" column="is_rack_equipment_name"/>
        <result property="dcRoomName" column="dc_room_name"/>
        <result property="datacenterName" column="datacenter_name"/>
        <result property="factoryName" column="factory_name"/>
        <result property="states"  column="states" />
        <result property="tdModelId" column="td_model_id" />
    </resultMap>

    <sql id="selectUmEquipmentVo">
                                    select equ.*,
                                         rack.rack_name           rack_name,
                                         aisle.rack_aisle_name    rack_aisle_name,
                                         room.dc_room_name        dc_room_name,
                                         factory.factory_name     factory_name,
                                         datacenter.datacenter_name datacenter_name,
                                         code.dict_label          equipment_type_name,
                                         yesno.dict_label         is_rack_equipment_name,
                                         manu_facturer.dict_label manu_facturer_name
                                  from um_equipment equ
                                           left join um_equipment_rack rack on equ.rack_id = rack.rack_id
                                           left join um_equipment_rack_aisle aisle on equ.rack_aisle_id = aisle.rack_aisle_id
                                           left join um_scene_datacenter_room room on equ.dc_room_id = room.dc_room_id
                                           left join um_scene_datacenter datacenter on equ.datacenter_id = datacenter.datacenter_id
                                           left join um_scene_factory factory on equ.factory_id = factory.factory_id
                                           left join (select * from sys_dict_data where dict_type = 'equipment_type')  code
                                                     on equ.equipment_type = code.dict_value
                                           left join (select  *from sys_dict_data where dict_type = 'manu_facturer') manu_facturer
                                                     on equ.manu_facturer = manu_facturer.dict_value
                                           left join (select * from sys_dict_data where dict_type = 'sys_yes_no') yesno on equ.is_rack_equipment = yesno.dict_value
    </sql>

    <select id="selectUmEquipmentList" parameterType="UmEquipment" resultMap="UmEquipmentResult">
        <include refid="selectUmEquipmentVo"/>
        <where>
            and equ.status = '0'
            <if test="manuFacturer != null  and manuFacturer != ''"> and equ.manu_facturer = #{manuFacturer} </if>
            <if test="equipmentName != null  and equipmentName != ''"> and equ.equipment_name like concat('%', #{equipmentName}, '%')</if>
            <if test="serialNo != null  and serialNo != ''"> and equ.serial_no like concat('%', #{serialNo}, '%')</if>
            <if test="modelName != null  and modelName != ''"> and equ.model_name like concat('%', #{modelName}, '%')</if>
            <if test="rackId != null  and rackId != ''"> and equ.rack_id like concat('%', #{rackId}, '%')</if>
            <if test="factoryId != null  and factoryId != ''"> and equ.factory_id like concat('%', #{factoryId}, '%')</if>
            <if test="datacenterId != null  and datacenterId != ''"> and equ.datacenter_id = #{datacenterId}</if>
            <if test="rackAisleId != null  and rackAisleId != ''"> and equ.rack_aisle_id like concat('%', #{rackAisleId}, '%')</if>
            <if test="dcRoomId != null  and dcRoomId != ''"> and equ.dc_room_id like concat('%', #{dcRoomId}, '%')</if>
            <if test="equipmentType != null  and equipmentType != ''"> and equ.equipment_type = #{equipmentType}</if>
            <if test="states != null  and states != ''"> and equ.states = #{states}</if>
        </where>
        order by equ.create_time desc
    </select>
    <!--查询未分配机柜的设备-->
    <select id="selectUmEquipmentListNoRack" parameterType="UmEquipment" resultMap="UmEquipmentResult">
        <include refid="selectUmEquipmentVo"/>
        <where>
            and equ.status = '0'
            and (equ.rack_id is null or equ.rack_id='')
            and  equ.is_rack_equipment = '01'
            and ( equ.equipment_type = '01' or equ.equipment_type = '02' or equ.equipment_type = '13')
            <if test="manuFacturer != null  and manuFacturer != ''"> and equ.manu_facturer = #{manuFacturer} </if>
            <if test="equipmentName != null  and equipmentName != ''"> and equ.equipment_name like concat('%', #{equipmentName}, '%')</if>
            <if test="serialNo != null  and serialNo != ''"> and equ.serial_no like concat('%', #{serialNo}, '%')</if>
            <if test="modelName != null  and modelName != ''"> and equ.model_name like concat('%', #{modelName}, '%')</if>
            <if test="factoryId != null  and factoryId != ''"> and equ.factory_id like concat('%', #{factoryId}, '%')</if>
            <if test="rackAisleId != null  and rackAisleId != ''"> and equ.rack_aisle_id like concat('%', #{rackAisleId}, '%')</if>
            <if test="dcRoomId != null  and dcRoomId != ''"> and equ.dc_room_id like concat('%', #{dcRoomId}, '%')</if>
        </where>
        order by equ.create_time desc
    </select>


    <select id="selectUmEquipmentById" parameterType="String" resultMap="UmEquipmentResult">
        <include refid="selectUmEquipmentVo"/>
        where equipment_id = #{equipmentId}
    </select>

    <select id="selectUmEquipmentlistByRackid" parameterType="UmEquipment" resultMap="UmEquipmentResult">
        SELECT rack_id AS 'pId',equipment_id AS 'key',equipment_name AS 'title' FROM um_equipment
            where  status='0'
    </select>

    <select id="selectUmEquipmentlistByequipmentId" parameterType="String"
            resultType="com.skill.manager.domain.UmEquipment">
        SELECT E.equipment_name as equipmentName,R.rack_name as rackName,A.rack_aisle_name as rackAisleName,M.dc_room_name as dcRoomName,S.datacenter_name as datacenterName,Q.Id FROM um_project_equipment Q LEFT JOIN	um_equipment E ON Q.equipment_id=E.equipment_id LEFT JOIN um_equipment_rack R ON E.rack_id=R.rack_id
        LEFT JOIN um_equipment_rack_aisle A ON R.rack_aisle_id=A.rack_aisle_id
        LEFT JOIN um_scene_datacenter_room M ON A.dc_room_id=M.dc_room_id
        LEFT JOIN um_scene_datacenter S ON M.datacenter_id=S.datacenter_id
        where  Q.project_id=#{projectId}
        ORDER BY E.equipment_name,R.rack_name,A.rack_aisle_name
    </select>


    <insert id="insertUmEquipment" parameterType="UmEquipment">
        insert into um_equipment
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="equipmentId != null  and equipmentId != ''">equipment_id,</if>
            <if test="rackId != null  and rackId != ''">rack_id,</if>
            <if test="rackAisleId != null  and rackAisleId != ''">rack_aisle_id,</if>
            <if test="dcRoomId != null  and dcRoomId != ''">dc_room_id,</if>
            <if test="datacenterId != null  and datacenterId != ''">datacenter_id,</if>
            <if test="factoryId != null  and factoryId != ''">factory_id,</if>
            <if test="equipmentType != null  and equipmentType != ''">equipment_type,</if>
            <if test="isRackEquipment != null  and isRackEquipment != ''">is_rack_equipment,</if>
            <if test="equipmentName != null  and equipmentName != ''">equipment_name,</if>
            <if test="serialNo != null  and serialNo != ''">serial_no,</if>
            <if test="manuFacturer != null  and manuFacturer != ''">manu_facturer,</if>
            <if test="modelName != null  and modelName != ''">model_name,</if>
            <if test="partsNo != null  and partsNo != ''">parts_no,</if>
            <if test="installationDate != null ">installation_date,</if>
            <if test="description != null  and description != ''">description,</if>
            <if test="width != null ">width,</if>
            <if test="height != null ">height,</if>
            <if test="depth != null ">depth,</if>
            <if test="skill != null ">skill,</if>
            <if test="startskill != null ">start_skill,</if>
            <if test="weight != null ">weight,</if>
            <if test="limitPower != null ">limit_power,</if>
            <if test="relativeX != null ">relative_x,</if>
            <if test="relativeY != null ">relative_y,</if>
            <if test="relativeZ != null ">relative_z,</if>
            <if test="absoluteX != null ">absolute_x,</if>
            <if test="absoluteY != null ">absolute_y,</if>
            <if test="absoluteZ != null ">absolute_z,</if>
            <if test="relativerotX != null ">relativerot_x,</if>
            <if test="relativerotY != null ">relativerot_y,</if>
            <if test="relativerotZ != null ">relativerot_z,</if>
            <if test="absoluterotX != null ">absoluterot_x,</if>
            <if test="absoluterotY != null ">absoluterot_y,</if>
            <if test="absoluterotZ != null ">absoluterot_z,</if>
            <if test="status != null  and status != ''">status,</if>
            <if test="createBy != null  and createBy != ''">create_by,</if>
            <if test="createTime != null ">create_time,</if>
            <if test="updateBy != null  and updateBy != ''">update_by,</if>
            <if test="updateTime != null ">update_time,</if>
            <if test="states != null  and states != ''">states,</if>
            <if test="tdModelId != null  and tdModelId != ''">td_model_id,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="equipmentId != null  and equipmentId != ''">#{equipmentId},</if>
            <if test="rackId != null  and rackId != ''">#{rackId},</if>
            <if test="rackAisleId != null  and rackAisleId != ''">#{rackAisleId},</if>
            <if test="dcRoomId != null  and dcRoomId != ''">#{dcRoomId},</if>
            <if test="datacenterId != null  and datacenterId != ''">#{datacenterId},</if>
            <if test="factoryId != null  and factoryId != ''">#{factoryId},</if>
            <if test="equipmentType != null  and equipmentType != ''">#{equipmentType},</if>
            <if test="isRackEquipment != null  and isRackEquipment != ''">#{isRackEquipment},</if>
            <if test="equipmentName != null  and equipmentName != ''">#{equipmentName},</if>
            <if test="serialNo != null  and serialNo != ''">#{serialNo},</if>
            <if test="manuFacturer != null  and manuFacturer != ''">#{manuFacturer},</if>
            <if test="modelName != null  and modelName != ''">#{modelName},</if>
            <if test="partsNo != null  and partsNo != ''">#{partsNo},</if>
            <if test="installationDate != null ">#{installationDate},</if>
            <if test="description != null  and description != ''">#{description},</if>
            <if test="width != null ">#{width},</if>
            <if test="height != null ">#{height},</if>
            <if test="depth != null ">#{depth},</if>
            <if test="skill != null ">#{skill},</if>
            <if test="startskill != null ">#{startskill},</if>
            <if test="weight != null ">#{weight},</if>
            <if test="limitPower != null ">#{limitPower},</if>
            <if test="relativeX != null ">#{relativeX},</if>
            <if test="relativeY != null ">#{relativeY},</if>
            <if test="relativeZ != null ">#{relativeZ},</if>
            <if test="absoluteX != null ">#{absoluteX},</if>
            <if test="absoluteY != null ">#{absoluteY},</if>
            <if test="absoluteZ != null ">#{absoluteZ},</if>
            <if test="relativerotX != null ">#{relativerotX},</if>
            <if test="relativerotY != null ">#{relativerotY},</if>
            <if test="relativerotZ != null ">#{relativerotZ},</if>
            <if test="absoluterotX != null ">#{absoluterotX},</if>
            <if test="absoluterotY != null ">#{absoluterotY},</if>
            <if test="absoluterotZ != null ">#{absoluterotZ},</if>
            <if test="status != null  and status != ''">#{status},</if>
            <if test="createBy != null  and createBy != ''">#{createBy},</if>
            <if test="createTime != null ">#{createTime},</if>
            <if test="updateBy != null  and updateBy != ''">#{updateBy},</if>
            <if test="updateTime != null ">#{updateTime},</if>
            <if test="states != null  and states != ''">#{states},</if>
            <if test="tdModelId != null  and tdModelId != ''">#{tdModelId},</if>
        </trim>
    </insert>

    <update id="updateUmEquipment" parameterType="UmEquipment">
        update um_equipment
        <trim prefix="SET" suffixOverrides=",">
            <if test="rackId != null ">rack_id = #{rackId},</if>
            <if test="rackAisleId != null ">rack_aisle_id = #{rackAisleId},</if>
            <if test="dcRoomId != null ">dc_room_id = #{dcRoomId},</if>
            <if test="datacenterId != null ">datacenter_id = #{datacenterId},</if>
            <if test="factoryId != null ">factory_id = #{factoryId},</if>
            <if test="equipmentType != null ">equipment_type = #{equipmentType},</if>
            <if test="isRackEquipment != null  ">is_rack_equipment = #{isRackEquipment},</if>
            <if test="equipmentName != null ">equipment_name = #{equipmentName},</if>
            <if test="serialNo != null  ">serial_no = #{serialNo},</if>
            <if test="manuFacturer != null ">manu_facturer = #{manuFacturer},</if>
            <if test="modelName != null ">model_name = #{modelName},</if>
            <if test="partsNo != null  ">parts_no = #{partsNo},</if>
            <if test="installationDate != null ">installation_date = #{installationDate},</if>
            <if test="description != null ">description = #{description},</if>
            <if test="width != null ">width = #{width},</if>
            <if test="height != null ">height = #{height},</if>
            <if test="depth != null ">depth = #{depth},</if>
            skill = #{skill},
            start_skill = #{startskill},
            <if test="weight != null ">weight = #{weight},</if>
            <if test="limitPower != null ">limit_power = #{limitPower},</if>
            <if test="relativeX != null ">relative_x = #{relativeX},</if>
            <if test="relativeY != null ">relative_y = #{relativeY},</if>
            <if test="relativeZ != null ">relative_z = #{relativeZ},</if>
            <if test="absoluteX != null ">absolute_x = #{absoluteX},</if>
            <if test="absoluteY != null ">absolute_y = #{absoluteY},</if>
            <if test="absoluteZ != null ">absolute_z = #{absoluteZ},</if>
            <if test="relativerotX != null ">relativerot_x = #{relativerotX},</if>
            <if test="relativerotY != null ">relativerot_y = #{relativerotY},</if>
            <if test="relativerotZ != null ">relativerot_z = #{relativerotZ},</if>
            <if test="absoluterotX != null ">absoluterot_x = #{absoluterotX},</if>
            <if test="absoluterotY != null ">absoluterot_y = #{absoluterotY},</if>
            <if test="absoluterotZ != null ">absoluterot_z = #{absoluterotZ},</if>
            <if test="status != null  and status != ''">status = #{status},</if>
            <if test="createBy != null  and createBy != ''">create_by = #{createBy},</if>
            <if test="createTime != null ">create_time = #{createTime},</if>
            <if test="updateBy != null  and updateBy != ''">update_by = #{updateBy},</if>
            <if test="updateTime != null ">update_time = #{updateTime},</if>
            <if test="states != null  and states != ''">states = #{states},</if>
            <if test="tdModelId != null ">td_model_id = #{tdModelId},</if>
        </trim>
        where equipment_id = #{equipmentId}
    </update>

    <!--逻辑删除时使用该语句-->
    <update id="deleteUmEquipmentByIds" parameterType="String">
        update um_equipment
        <trim prefix="SET" suffixOverrides=",">
            status = '1'
        </trim>
        where  equipment_id in
        <foreach item="equipmentId" collection="array" open="(" separator="," close=")">
            #{equipmentId}
        </foreach>
    </update>

    <delete id="deleteUmEquipmentById" parameterType="String">
        delete from um_equipment where equipment_id = #{equipmentId}
    </delete>

<!--    <delete id="deleteUmEquipmentByIds" parameterType="String">-->
<!--        delete from um_equipment where equipment_id in-->
<!--        <foreach item="equipmentId" collection="array" open="(" separator="," close=")">-->
<!--            #{equipmentId}-->
<!--        </foreach>-->
<!--    </delete>-->

</mapper>